version: "3.8"

services:
  apt-cacher-ng:
    build:
      context: ./apt-cacher-ng
      dockerfile: Dockerfile
    volumes:
      - apt-cache:/var/cache/apt-cacher-ng
    ports:
      - "3142:3142"
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 512M

  runner:
    image: pwd9000-github-runner-lin:latest
    build:
      network: host
      context: .
      dockerfile: Dockerfile
      args:
        RUNNER_VERSION: "2.311.0"
    environment:
      GH_TOKEN: ${GH_TOKEN}
      GH_OWNER: ${GH_OWNER}
      GH_REPOSITORY: ${GH_REPOSITORY}
    depends_on:
      - apt-cacher-ng
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 2048M

volumes:
  apt-cache: {}
